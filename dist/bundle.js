!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("d3"),require("lodash")):"function"==typeof define&&define.amd?define(["d3","lodash"],e):t.RadarChart=e(t.d3,t._)}(this,function(x,c){"use strict";var v=2*Math.PI,s=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t=function(){function a(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,e,i){return e&&a(t.prototype,e),i&&a(t,i),t}}(),g="QUAD_1",m="QUAD_2",a=function(){function a(t,e,i){s(this,a),this.opts=t,this.axisIndex=i,this.axisOptions=e,this.dragActive=!1,this.axisTickTextElements=[],this.calculateAxisParameters()}return t(a,[{key:"calculateAxisParameters",value:function(){var t=this.opts,e=this.axisIndex,i=this.axisOptions,a=this.opts.dims,s=a.width,r=a.height,n=this.opts.axis.maxAxisNo,o=s/2,l=r/2,c=s/2*(1-Math.sin(e*v/n)),u=r/2*(1-Math.cos(e*v/n));c<o&&u<=l?this.quad=g:o<=c&&u<=l?this.quad=m:c<=o&&l<=u?this.quad="QUAD_3":o<=c&&l<=u&&(this.quad="QUAD_4");var h=s/2*(1-t.legend.factor*Math.sin(e*v/n))-60*Math.sin(e*v/n),d=r/2*(1-Math.cos(e*v/n))-20*Math.cos(e*v/n),p=Math.abs(c-o)<1e-9?1/0:(u-l)/(c-o),x=p===1/0?0:u-p*c;this.gradient=p;this.maxValue=t.axis.useGlobalMax?t.axis.maxValue:i.axisValueMax,this.axisLength=Math.sqrt(Math.pow(c-o,2)+Math.pow(u-l,2)),this.angleFromNorth=180/Math.PI*(1-e*v/n)-180/Math.PI-90-180/Math.PI*10/this.axisLength/2,this.axis=i.axisId,this.label=i.label?i.label:i.axisId,this.x1=o,this.y1=l,this.x2=c,this.y2=u,this.labelX=h,this.labelY=d;var f=Math.sin(e*v/n),y=Math.cos(e*v/n);this.projectCordToAxis=function(t,e){return p===1/0?{x:o,y:e}:p<-2||0<=p||p<.145?{x:t,y:p*t+x}:{x:(e-x)/p,y:e}},this.projectValueOnAxis=function(t){return{x:s/2*(1-parseFloat(Math.max(t,0))/this.maxValue*f),y:r/2*(1-parseFloat(Math.max(t,0))/this.maxValue*y)}},this.cordOnAxisToValue=function(t,e){if(this.gradient===1/0){var i=Math.abs(this.y2-e);return(this.axisLength-i)*this.maxValue/this.axisLength}if(0<=this.gradient&&this.gradient<1e-8){var a=Math.abs(this.x2-t);return(this.axisLength-a)*this.maxValue/this.axisLength}return(2*t/s-1)*(this.maxValue/f)*-1}}},{key:"onRectMouseOver",value:function(){if(this.dragActive)return!1;this.axisTickTextElements.forEach(function(t){x.select(t).style("opacity",.9)})}},{key:"onRectMouseOut",value:function(){if(this.dragActive)return!1;this.axisTickTextElements.forEach(function(t){x.select(t).transition(200).style("opacity",0)})}}]),a}(),r=function(){function i(t){var e=this;s(this,i),this.axisMap=t.axisMap,this.data=c.cloneDeep(t.series),this.drawingContext=t.drawingContext,this.color=x.scaleOrdinal(x.schemeAccent),this.seriesIdent=t.seriesIdent,this.seriesIndex=t.seriesIndex,this.opts=c.cloneDeep(t.areaOptions),this.opts.onValueChange=t.areaOptions.onValueChange,this.opts.colorScale=t.areaOptions.colorScale,this.circleRadius=5,this.polygonClassName="chart-poly-"+this.seriesIdent,this.circleOverlayClassName="circle-overlay"+this.seriesIdent,this.circleClassName="circle-"+this.seriesIdent,this.points=this.data.map(function(t){return{cords:e.axisMap[t.axis].projectValueOnAxis(t.value),datum:c.cloneDeep(t)}}),this.polygonWrapper={points:this.points,svgStringRep:this.points.reduce(function(t,e){return t+e.cords.x+","+e.cords.y+" "},"")}}return t(i,[{key:"render",value:function(){this.renderArea(),this.renderCircles()}},{key:"updatePositions",value:function(){this.polygonWrapper.svgStringRep=this.points.reduce(function(t,e){return t+e.cords.x+","+e.cords.y+" "},""),this.removeArea(),this.renderArea()}},{key:"createOnMouseOverCircle",value:function(){var i=this;return function(t){var e="."+i.polygonClassName;x.select(this).style("fill-opacity",i.opts.hoverCircleOpacity),i.drawingContext().selectAll("polygon").transition(200).style("fill-opacity",i.opts.hiddenAreaOpacity),i.drawingContext().selectAll(e).transition(200).style("fill-opacity",i.opts.highlightedAreaOpacity),x.select(t.circleRef).transition(100).attr("r",i.circleRadius*i.opts.circleOverlayRadiusMult)}}},{key:"createMouseOutCirlce",value:function(){var e=this;return function(t){x.select(this).style("fill-opacity",e.opts.defaultCircleOpacity),e.drawingContext().selectAll("polygon").transition(200).style("fill-opacity",e.opts.defaultAreaOpacity),x.select(t.circleRef).transition(100).attr("r",e.circleRadius)}}},{key:"createOnDragEndCircle",value:function(){var e=this;return function(t){e.axisMap[t.datum.axis].dragActive=!1,e.axisMap[t.datum.axis].onRectMouseOut()}}},{key:"createOnDraggingCircle",value:function(){var l=this;return function(t){var e=l.axisMap[t.datum.axis];l.axisMap[t.datum.axis].onRectMouseOver(),l.axisMap[t.datum.axis].dragActive=!0;var i=x.event,a=i.x,s=i.y,r=e.projectCordToAxis(a,s).x,n=e.projectCordToAxis(a,s).y;if(e.quad===g||e.quad===m){if(n<e.y2||n>e.y1)return}else if(n<e.y1||n>e.y2)return;var o=e.cordOnAxisToValue(r,n);t.datum.value=o,t.cords=l.axisMap[t.datum.axis].projectValueOnAxis(o),x.select(t.circleRef).attr("cx",r).attr("cy",n),x.select(t.overlayRef).attr("cx",r).attr("cy",n),l.updatePositions(),c.isFunction(l.opts.onValueChange)&&l.opts.onValueChange(t)}}},{key:"createOnMouseOverPolygon",value:function(){var i=this;return function(t){var e="."+i.polygonClassName;i.drawingContext().selectAll("polygon").transition(200).style("fill-opacity",i.opts.hiddenAreaOpacity),i.drawingContext().selectAll(e).transition(200).style("fill-opacity",i.opts.highlightedAreaOpacity)}}},{key:"createOnMouseOutPolygon",value:function(){var e=this;return function(t){x.select(this).transition(200).style("fill-opacity",e.opts.defaultAreaOpacity)}}},{key:"renderArea",value:function(){var t=this;this.area=this.drawingContext().selectAll(this.polygonClassName).data([this.polygonWrapper]).enter().append("polygon").attr("class",this.polygonClassName).style("stroke-width","2px").style("stroke",function(){if(t.opts.useColorScale)return t.opts.lineColorScale(t.seriesIndex)}).attr("points",function(t){return t.svgStringRep}).attr("z-index",-1).style("fill",function(){if(t.opts.useColorScale)return t.opts.areaColorScale(t.seriesIndex)}).style("fill-opacity",this.opts.defaultAreaOpacity).on("mouseover",this.createOnMouseOverPolygon()).on("mouseout",this.createOnMouseOutPolygon())}},{key:"renderCircles",value:function(){var t=this;this.circles=this.drawingContext().selectAll(this.circleClassName).data(this.points).enter().append("svg:circle").attr("r",this.circleRadius).attr("alt",function(t){return Math.max(t.value,0)}).attr("cx",function(t){return t.cords.x}).attr("cy",function(t){return t.cords.y}).attr("class",this.circleClassName).style("fill",function(){if(t.opts.useColorScale)return t.opts.lineColorScale(t.seriesIndex)}).style("fill-opacity",this.opts.defaultCircleOpacity).each(function(t){t.circleRef=this}),this.circleOverylays=this.drawingContext().selectAll(this.circleOverlayClassName).data(this.points).enter().append("svg:circle").call(x.drag().subject(function(t){return this}).on("drag",this.createOnDraggingCircle()).on("end",this.createOnDragEndCircle())).attr("r",this.circleRadius*this.opts.circleOverlayRadiusMult).attr("cx",function(t){return t.cords.x}).attr("cy",function(t){return t.cords.y}).attr("opacity",0).attr("class",this.circleOverlayClassName).on("mouseover",this.createOnMouseOverCircle()).on("mouseout",this.createMouseOutCirlce()).each(function(t){t.overlayRef=this}),this.circles.append("svg:title").text(function(t){return t.datum.value})}},{key:"removeArea",value:function(){this.area.on("mouseover",null).on("mouseout",null),this.area.remove()}},{key:"remove",value:function(){this.circleOverylays.each(function(t){x.select(t.circleRef).on("mouseover",null).on("mouseout",null).on("drag",null).on("end",null).remove()}),this.circles.each(function(t){x.select(t.circleRef).remove()}),this.removeArea()}}]),i}();return function(){function e(t){s(this,e),this.rootElement=x.select(t.rootElement),this.setOps(t),this.areas=[]}return t(e,[{key:"setOps",value:function(t){var i=this;this.opts=c.merge({data:[],dims:{width:500,height:500,extraWidthP:.6,extraHeightP:.25,translateXp:.1,translateYp:.05},showLegend:!0,legend:{height:100,width:200,factor:.85,translateX:-75,translateY:10,textTranslateX:-52,textSpacing:20,textYOffset:9,colorScale:x.scaleOrdinal(x.schemeAccent),iconHeight:10,iconWidth:10,iconSpacing:20,title:"Test title",titleProperties:{"font-size":"12px",fill:"#404040"},labelTextProperties:{"font-size":"11px",fill:"#737373"}},levels:{levelsNo:2,noTicks:3,levelsColor:null,ticks:{fill:"#737373","font-size":"10px","font-family":"sans-serif"}},point:{radius:5},axis:{config:[],colorScale:null,useGlobalMax:!1,maxValue:.6},area:{defaultAreaOpacity:.4,highlightedAreaOpacity:.7,hiddenAreaOpacity:.1,defaultCircleOpacity:.3,hoverCircleOpacity:1,circleOverlayRadiusMult:1.2,useColorScale:!0,areaColorScale:x.scaleOrdinal(x.schemeAccent),lineColorScale:x.scaleOrdinal(x.schemeAccent),onValueChange:null},rootElement:null},t),this.rootElId=this.rootElement.attr("id"),this.opts.axis.maxAxisNo=this.opts.axis.config.length,this.opts.dims.extraWidth=this.opts.dims.width*this.opts.dims.extraWidthP,this.opts.dims.extraHeight=this.opts.dims.height*this.opts.dims.extraHeightP,this.opts.dims.translateX=(this.opts.dims.width+this.opts.dims.extraWidth)*this.opts.dims.translateXp,this.opts.dims.translateY=(this.opts.dims.height+this.opts.dims.extraHeight)*this.opts.dims.translateYp,this.data=this.opts.data,this.axisConfig=this.opts.axis.config,this.axisParameters=this.axisConfig.map(function(t,e){return new a(i.opts,t,e)}),this.axisMap=this.axisParameters.reduce(function(t,e){return t[e.axis]=e,t},{})}},{key:"render",value:function(){this.renderAxis(),this.renderArea(),this.opts.showLegend&&this.renderLegend()}},{key:"renderAxis",value:function(){var o=this,t=this.opts,e=this.opts.dims,i=e.width,a=e.height,s=e.extraWidth,r=e.extraHeight,n=e.translateX,l=e.translateY;this.rootSvg=this.rootElement.append("svg").attr("width",i+s).attr("height",a+r),this.rootSvg.append("g").attr("class","root"+this.rootElId).attr("transform","translate("+n+","+l+")"),this.drawingContext=function(){var t=this.rootElId.toString();return function(){return x.select(".root"+t)}}.bind(this)();for(var c=function(r){var n=t.levels.levelsNo;o.drawingContext().selectAll(".levels").data(o.axisParameters).enter().append("svg:line").attr("x1",function(t,e){var i=t.maxValue/n*(r+1);return t.projectValueOnAxis(i).x}).attr("y1",function(t,e){var i=t.maxValue/n*(r+1);return t.projectValueOnAxis(i).y}).attr("x2",function(t,e){var i=e+1===o.axisParameters.length?0:e+1,a=o.axisParameters[i],s=a.maxValue/n*(r+1);return a.projectValueOnAxis(s).x}).attr("y2",function(t,e){var i=e+1===o.axisParameters.length?0:e+1,a=o.axisParameters[i],s=a.maxValue/n*(r+1);return a.projectValueOnAxis(s).y}).attr("class","line").style("stroke","grey").style("stroke-opacity","0.75").style("stroke-width","0.3px")},u=0;u<t.levels.levelsNo-1;u++)c(u);var h=x.format(".2%"),d=t.levels.ticks,p=function(i){var a=t.levels.levelsNo;o.drawingContext().selectAll(".levels").data(o.axisParameters).enter().append("svg:text").attr("x",function(t){var e=t.maxValue/a*(i+1);return t.projectValueOnAxis(e).x}).attr("y",function(t){var e=t.maxValue/a*(i+1);return t.projectValueOnAxis(e).y}).attr("class","legend").style("font-family",d["font-family"]).style("font-size",d["font-size"]).style("opacity",0).attr("fill",d.fill).text(function(t){return h(t.maxValue/a*(i+1)/t.maxValue)}).each(function(t){t.axisTickTextElements.push(this)})};for(u=0;u<t.levels.levelsNo;u++)p(u);this.axisG=this.drawingContext().selectAll(".axis").data(this.axisParameters).enter().append("g"),this.axisLines=this.axisG.attr("class","axis").append("line").attr("x1",function(t){return t.x1}).attr("y1",function(t){return t.y1}).attr("x2",function(t){return t.x2}).attr("y2",function(t){return t.y2}).attr("class","line").attr("pointer-events","none").style("stroke","grey").style("stroke-width","1px"),this.rects=this.axisG.append("rect").attr("class","overlay").attr("x",function(t){return t.x1}).attr("y",function(t){return t.y1}).attr("transform",function(t,e){return"rotate("+t.angleFromNorth+","+t.x1+","+t.y1+")"}).attr("width",function(t){return t.axisLength}).attr("height",10).attr("fill-opacity",0).on("mouseover",function(t){return t.onRectMouseOver()}).on("mouseout",function(t){return t.onRectMouseOut()}).each(function(t){t.axisRect=this}),this.axisText=this.axisG.append("text").attr("class","legend").text(function(t){return t.label}).style("font-family","sans-serif").style("font-size","11px").attr("text-anchor","middle").attr("dy","1.5em").attr("transform",function(){return"translate(0, -10)"}).attr("x",function(t){return t.labelX}).attr("y",function(t){return t.labelY}).attr("pointer-events","none")}},{key:"renderArea",value:function(){var i=this;this.areas=this.data.map(function(t,e){return new r({axisMap:i.axisMap,series:t,drawingContext:i.drawingContext,seriesIdent:""+e+i.rootElId,seriesIndex:e,areaOptions:i.opts.area})}),this.areas.forEach(function(t){return t.render()})}},{key:"renderLegend",value:function(){var t=this.opts.dims,e=t.width,i=t.height,a=t.extraWidth,s=this.opts.legend,r=["Smartphone","Tablet"],n=this.rootSvg.append("svg").attr("width",e+a).attr("height",i);n.append("text").attr("class","title").attr("transform","translate(90,0)").attr("x",e+s.translateX).attr("y",s.translateY).text(s.title).attr("font-size",s.titleProperties["font-size"]).attr("fill",s.titleProperties.fill);var o=n.append("g").attr("class","legend").attr("height",s.height).attr("width",s.width).attr("transform","translate(90,20)");o.selectAll("rect").data(r).enter().append("rect").attr("x",e+s.translateX).attr("y",function(t,e){return e*s.iconSpacing}).attr("width",s.iconWidth).attr("height",s.iconHeight).style("fill",function(t,e){return s.colorScale(e)}),o.selectAll("text").data(r).enter().append("text").attr("x",e+s.textTranslateX).attr("y",function(t,e){return e*s.textSpacing+s.textYOffset}).attr("font-size",s.labelTextProperties["font-size"]).attr("fill",s.labelTextProperties.fill).text(function(t){return t})}},{key:"reRenderWithNewData",value:function(t){this.data=t,this.removeAreas(),this.renderArea()}},{key:"removeAxis",value:function(){this.axisLines.remove(),this.axisText.remove(),this.rects.each(function(t){x.select(t.axisRect).on("mouseover",null).on("mouseout",null).remove()})}},{key:"removeAreas",value:function(){this.areas.forEach(function(t){return t.remove()})}},{key:"delete",value:function(){this.removeAreas(),this.removeAxis(),this.rootSvg.remove()}}]),e}()});
